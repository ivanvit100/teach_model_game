var ie=Object.defineProperty;var re=(t,e,n)=>e in t?ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e,n)=>re(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function S(){}function Y(t){return t()}function C(){return Object.create(null)}function T(t){t.forEach(Y)}function Z(t){return typeof t=="function"}function q(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let O;function H(t,e){return t===e?!0:(O||(O=document.createElement("a")),O.href=e,t===O.href)}function se(t){return Object.keys(t).length===0}function oe(t,...e){if(t==null){for(const i of e)i(void 0);return S}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function le(t,e,n){t.$$.on_destroy.push(oe(e,n))}function _(t,e){t.appendChild(e)}function w(t,e,n){t.insertBefore(e,n||null)}function y(t){t.parentNode&&t.parentNode.removeChild(t)}function x(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function v(t){return document.createElement(t)}function L(t){return document.createTextNode(t)}function $(){return L(" ")}function ae(){return L("")}function ee(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ce(t){return Array.from(t.childNodes)}function G(t,e){e=""+e,t.data!==e&&(t.data=e)}function z(t,e,n,i){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,"")}let N;function M(t){N=t}function ue(){if(!N)throw new Error("Function called outside component initialization");return N}function fe(t){ue().$$.on_mount.push(t)}const k=[],W=[];let I=[];const D=[],de=Promise.resolve();let R=!1;function he(){R||(R=!0,de.then(te))}function B(t){I.push(t)}const U=new Set;let E=0;function te(){if(E!==0)return;const t=N;do{try{for(;E<k.length;){const e=k[E];E++,M(e),pe(e.$$)}}catch(e){throw k.length=0,E=0,e}for(M(null),k.length=0,E=0;W.length;)W.pop()();for(let e=0;e<I.length;e+=1){const n=I[e];U.has(n)||(U.add(n),n())}I.length=0}while(k.length);for(;D.length;)D.pop()();R=!1,U.clear(),M(t)}function pe(t){if(t.fragment!==null){t.update(),T(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(B)}}function me(t){const e=[],n=[];I.forEach(i=>t.indexOf(i)===-1?e.push(i):n.push(i)),n.forEach(i=>i()),I=e}const ge=new Set;function _e(t,e){t&&t.i&&(ge.delete(t),t.i(e))}function A(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ve(t,e,n){const{fragment:i,after_update:r}=t.$$;i&&i.m(e,n),B(()=>{const s=t.$$.on_mount.map(Y).filter(Z);t.$$.on_destroy?t.$$.on_destroy.push(...s):T(s),t.$$.on_mount=[]}),r.forEach(B)}function be(t,e){const n=t.$$;n.fragment!==null&&(me(n.after_update),T(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ye(t,e){t.$$.dirty[0]===-1&&(k.push(t),he(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function we(t,e,n,i,r,s,o=null,a=[-1]){const f=N;M(t);const l=t.$$={fragment:null,ctx:[],props:s,update:S,not_equal:r,bound:C(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:C(),dirty:a,skip_bound:!1,root:e.target||f.$$.root};o&&o(l.root);let u=!1;if(l.ctx=n?n(t,e.props||{},(c,g,...d)=>{const p=d.length?d[0]:g;return l.ctx&&r(l.ctx[c],l.ctx[c]=p)&&(!l.skip_bound&&l.bound[c]&&l.bound[c](p),u&&ye(t,c)),g}):[],l.update(),u=!0,T(l.before_update),l.fragment=i?i(l.ctx):!1,e.target){if(e.hydrate){const c=ce(e.target);l.fragment&&l.fragment.l(c),c.forEach(y)}else l.fragment&&l.fragment.c();e.intro&&_e(t.$$.fragment),ve(t,e.target,e.anchor),te()}M(f)}class Se{constructor(){b(this,"$$");b(this,"$$set")}$destroy(){be(this,1),this.$destroy=S}$on(e,n){if(!Z(n))return S;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!se(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $e="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($e);const P=[];function Ee(t,e=S){let n;const i=new Set;function r(a){if(q(t,a)&&(t=a,n)){const f=!P.length;for(const l of i)l[1](),P.push(l,t);if(f){for(let l=0;l<P.length;l+=2)P[l][0](P[l+1]);P.length=0}}}function s(a){r(a(t))}function o(a,f=S){const l=[a,f];return i.add(l),i.size===1&&(n=e(r,s)||S),a(t),()=>{i.delete(l),i.size===0&&n&&(n(),n=null)}}return{set:r,update:s,subscribe:o}}async function Pe(t,e={},n){return window.__TAURI_INTERNALS__.invoke(t,e,n)}const ne=Ee(null);class ke{constructor(e,n){b(this,"Page");b(this,"Situations");this.Page=e,this.Situations=n}async updateParameters(e){ne.set(e),this.Situations.situation=e,this.Page.parameters.forEach(r=>{const s=document.getElementById(r.id);s&&(s.style.height=`${r.value*10}%`)});const n=this.Situations.calculateOverallScore(),i=document.getElementById("overall-bar");i&&(i.style.width=`${n}%`)}displayWarnings(){const e=document.getElementById("warnings");e&&(e.innerHTML="",this.Page.parameters.forEach(n=>{if(n.value<=2){const i=document.createElement("div");i.className="warning",i.innerText=n.warn,e.appendChild(i)}}))}displayEndGameMessage(e){const n=document.getElementById("warnings");if(!n)return;n.innerHTML="";const i=document.createElement("div");i.className="end-game",i.innerText=`Игра окончена! ${e}

Ваш результат: ${this.Page.score} очков`,n.appendChild(i),this.Page.flag=!1}clearWarnings(){const e=document.getElementById("warnings");e&&(e.innerHTML="")}}class Ie{constructor(e){b(this,"Page");b(this,"situation",{});b(this,"now",0);this.Page=e,this.getParameters(),this.getRandomSituation()}async getParameters(){try{const[e]=await Promise.all([fetch("/parameters.json")]);this.Page.parameters=await e.json(),this.Page.start()}catch(e){console.error("[Situations] | getParameters(): ",e)}}async getRandomSituation(){try{return this.situation=await Pe("generate_question",{day:this.now}),this.situation}catch(e){throw console.error("[Situations] | getRandomSituation(): ",e),e}}calculateOverallScore(){const n=this.Page.parameters.reduce((o,a)=>o+a.value,0),i=this.Page.parameters.reduce((o,a)=>o+1/a.value,0)*10,r=n/50*100,s=Math.max(0,100-r-i);return Math.min(100,r-s)}}class Le{constructor(){b(this,"UI");b(this,"Situations");b(this,"score",0);b(this,"flag",!0);b(this,"parameters",[]);b(this,"init",!1);this.Situations=new Ie(this),this.UI=new ke(this,this.Situations)}async start(){const e=this.Situations.getRandomSituation();requestAnimationFrame(async()=>{this.UI.updateParameters(await e)})}async restart(){await this.Situations.getParameters(),this.score=0,this.Situations.now=0,this.flag=!0,this.init=!0,this.start(),this.UI.clearWarnings()}checkEndGame(){const e=this.parameters.find(n=>n.value<=0);return e?(this.UI.updateParameters(this.Situations.situation),this.UI.displayEndGameMessage(e.message),this.init=!1,!0):!1}}function F(t,e,n){const i=t.slice();return i[6]=e[n],i}function K(t,e,n){const i=t.slice();return i[9]=e[n],i}function Me(t){let e,n,i,r;return{c(){e=v("div"),n=v("input"),m(n,"type","button"),n.value="Начать игру",m(e,"class","start")},m(s,o){w(s,e,o),_(e,n),i||(r=ee(n,"click",t[4]),i=!0)},p:S,d(s){s&&y(e),i=!1,r()}}}function Ne(t){let e,n,i=t[0],r,s,o,a,f=t[2].score+"",l,u=A(t[2].parameters),c=[];for(let d=0;d<u.length;d+=1)c[d]=V(K(t,u,d));let g=X(t);return{c(){e=v("div");for(let d=0;d<c.length;d+=1)c[d].c();n=$(),g.c(),r=$(),s=v("div"),o=v("div"),a=L("Счет: "),l=L(f),m(e,"class","parameters"),m(o,"id","score"),m(s,"class","status")},m(d,p){w(d,e,p);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(e,null);w(d,n,p),g.m(d,p),w(d,r,p),w(d,s,p),_(s,o),_(o,a),_(o,l)},p(d,p){if(p&4){u=A(d[2].parameters);let h;for(h=0;h<u.length;h+=1){const j=K(d,u,h);c[h]?c[h].p(j,p):(c[h]=V(j),c[h].c(),c[h].m(e,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=u.length}p&1&&q(i,i=d[0])?(g.d(1),g=X(d),g.c(),g.m(r.parentNode,r)):g.p(d,p),p&4&&f!==(f=d[2].score+"")&&G(l,f)},d(d){d&&(y(e),y(n),y(r),y(s)),x(c,d),g.d(d)}}}function V(t){let e,n,i,r,s,o,a=t[9].label+"",f,l,u,c,g,d;return{c(){e=v("div"),n=v("div"),i=v("img"),o=$(),f=L(a),l=$(),u=v("div"),c=v("div"),d=$(),H(i.src,r=`icons/${t[9].id}.png`)||m(i,"src",r),m(i,"alt",s=t[9].label),m(i,"class","icon"),m(n,"class","parameter-label"),m(c,"class","progress"),z(c,"background-color",t[9].color),m(c,"id",g=t[9].id),m(u,"class","progress-bar"),m(e,"class","parameter")},m(p,h){w(p,e,h),_(e,n),_(n,i),_(n,o),_(n,f),_(e,l),_(e,u),_(u,c),_(e,d)},p(p,h){h&4&&!H(i.src,r=`icons/${p[9].id}.png`)&&m(i,"src",r),h&4&&s!==(s=p[9].label)&&m(i,"alt",s),h&4&&a!==(a=p[9].label+"")&&G(f,a),h&4&&z(c,"background-color",p[9].color),h&4&&g!==(g=p[9].id)&&m(c,"id",g)},d(p){p&&y(e)}}}function J(t){let e,n=A(t[0].actions),i=[];for(let r=0;r<n.length;r+=1)i[r]=Q(F(t,n,r));return{c(){for(let r=0;r<i.length;r+=1)i[r].c();e=ae()},m(r,s){for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(r,s);w(r,e,s)},p(r,s){if(s&7){n=A(r[0].actions);let o;for(o=0;o<n.length;o+=1){const a=F(r,n,o);i[o]?i[o].p(a,s):(i[o]=Q(a),i[o].c(),i[o].m(e.parentNode,e))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(r){r&&y(e),x(i,r)}}}function Q(t){let e,n,i,r,s;function o(){return t[3](t[6])}return{c(){e=v("input"),m(e,"type","button"),e.disabled=n=!t[2].flag,e.value=i=t[6].description},m(a,f){w(a,e,f),r||(s=ee(e,"click",o),r=!0)},p(a,f){t=a,f&4&&n!==(n=!t[2].flag)&&(e.disabled=n),f&1&&i!==(i=t[6].description)&&(e.value=i)},d(a){a&&y(e),r=!1,s()}}}function X(t){var f;let e,n,i=((f=t[0])==null?void 0:f.description)+"",r,s,o,a=t[0]&&J(t);return{c(){e=v("div"),n=v("div"),r=L(i),s=$(),o=v("div"),a&&a.c(),m(n,"class","situation"),m(e,"class","card"),m(o,"class","actions")},m(l,u){w(l,e,u),_(e,n),_(n,r),w(l,s,u),w(l,o,u),a&&a.m(o,null)},p(l,u){var c;u&1&&i!==(i=((c=l[0])==null?void 0:c.description)+"")&&G(r,i),l[0]?a?a.p(l,u):(a=J(l),a.c(),a.m(o,null)):a&&(a.d(1),a=null)},d(l){l&&(y(e),y(s),y(o)),a&&a.d()}}}function Oe(t){let e,n,i,r,s,o,a;function f(c,g){if(c[2]&&c[2].init)return Ne;if(c[2])return Me}let l=f(t),u=l&&l(t);return{c(){e=v("div"),n=v("header"),n.innerHTML="<h1>Teacher Life Game</h1>",i=$(),u&&u.c(),r=$(),s=v("div"),o=$(),a=v("div"),a.innerHTML='<div class="overall-label">Общая оценка</div> <div class="overall-bar"><div class="overall-progress" id="overall-bar"></div></div>',m(s,"id","warnings"),m(s,"class","warnings"),m(a,"class","overall-container"),m(e,"id","app")},m(c,g){w(c,e,g),_(e,n),_(e,i),u&&u.m(e,null),_(e,r),_(e,s),_(e,o),_(e,a)},p(c,[g]){l===(l=f(c))&&u?u.p(c,g):(u&&u.d(1),u=l&&l(c),u&&(u.c(),u.m(e,r)))},i:S,o:S,d(c){c&&y(e),u&&u.d()}}}function Ae(t,e,n){let i;le(t,ne,f=>n(0,i=f));let r,s;fe(async()=>{n(2,s=new Le),n(1,r=async f=>{if(s.parameters.forEach(u=>{u.value=Math.min(10,u.value+f.effects[u.id])}),s.checkEndGame())return;s.UI.displayWarnings(),n(2,s.score++,s),n(2,s.Situations.now++,s);const l=await s.Situations.getRandomSituation();s.UI.updateParameters(l)})});const o=f=>r(f),a=()=>s.restart();return t.$$.update=()=>{t.$$.dirty&1},[i,r,s,o,a]}class Te extends Se{constructor(e){super(),we(this,e,Ae,Oe,q,{})}}new Te({target:document.body,props:{}});
